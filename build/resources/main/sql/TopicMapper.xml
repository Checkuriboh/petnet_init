<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.petnet.domain.topic.mapper.TopicMapper">

    <resultMap id="topicSelectMap" type="Topic">
        <id property="topicId" column="TOPIC_ID" /> <!-- 기본 키 매핑 -->
        <result property="authorId" column="AUTHOR_ID" />
        <result property="authorName" column="nickname" />
        <result property="category" column="TOPIC_TYPE"/>
        <result property="title" column="TITLE" />
        <result property="content" column="CONTENT" />
        <result property="viewCount" column="VIEW_COUNT" />
        <result property="likeCount" column="LIKE_COUNT" />
        <result property="dislikeCount" column="DISLIKE_COUNT" />
        <result property="addDate" column="ADD_DATE" />
        <result property="updateDate" column="UPDATE_DATE" />
        <result property="files" column="FILES" javaType="java.lang.String"/>
        <result property="isDownloadable" column="IS_DOWNLOADABLE" />
    </resultMap>

    <!-- SQL : SELECT ONE -->
    <select id="getTopic" parameterType="string" resultMap="topicSelectMap">
        SELECT
            topic_id,
            author_id,
            topic_type,
            title,
            content,
            view_count,
            like_count,
            dislike_count,
            add_date,
            update_date,
            files,
            is_downloadable
        FROM topic
        WHERE topic_id = #{topicId}
    </select>

    <!-- SQL : SELECT LIST -->
    <select id="getTopics" parameterType="map" resultMap="topicSelectMap">
        SELECT	t.topic_id, t.author_id, u.nickname, t.topic_type, t.title, t.like_count, t.add_date
        FROM topic as t,
             user as u
        <where>
            t.author_id = u.user_id
            <if test="range == '2'">
                AND t.author_id = #{userId}
            </if>
            <if test="category != null">
                AND t.topic_type = #{category}
            </if>
            <if test="condition != null">
                <if test="condition == '1'">
                    AND t.title Like '%${keyword}%'
                </if>
                <if test="condition == '2'">
                    AND t.content Like '%${keyword}%'
                </if>
                <if test="condition == '3'">
                    AND u.nickname Like '%${keyword}%'
                </if>
            </if>
        </where>
        ORDER BY t.add_date desc;
    </select>

</mapper>
